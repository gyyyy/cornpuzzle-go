# cornpuzzle-go

[![Go Version](https://img.shields.io/badge/go-1.24.2+-blue.svg)](https://golang.org)
[![License](https://img.shields.io/badge/license-Apache%202.0-green.svg)](LICENSE)

一个高效的Go语言实现的玉米3D拼图求解器，使用先进的回溯算法和多种优化技术。

## 🎯 功能特性

- **高效求解算法**: 基于回溯算法，结合多种启发式优化
- **智能预处理**: 预计算块复杂度、周长等特征
- **动态排序优化**: 根据当前空洞边界动态调整块选择顺序
- **剪枝优化**: 提前终止无解分支，减少搜索空间
- **命令行工具**: 简单易用的命令行接口
- **编程接口**: 提供完整的Go API用于集成
- **详细日志**: 支持详细的求解过程输出

## 🚀 性能优化

项目实现了多层优化策略：

### 核心优化技术
- **预检查**: 验证拼图块总面积与板子匹配
- **静态排序**: 按块复杂度预排序，优先尝试简单块
- **动态嵌入度排序**: 根据当前空洞边界长度动态排序，优先选择周长匹配的块
- **边界剪枝**: 实时计算空位边界，优化块选择策略

### 性能提升
- **求解时间**: 从初始~87秒优化至~24.57秒 (约3.5倍加速)
- **搜索效率**: 通过智能启发式大幅减少无效搜索路径

## 📦 安装

### 要求
- Go 1.24.2 或更高版本

### 安装步骤
```bash
# 克隆仓库
git clone https://github.com/gyyyy/cornpuzzle-go.git
cd cornpuzzle-go

# 构建项目
go build -o cornpuzzle main.go
```

## 💡 使用方法

### 命令行工具

```bash
# 基本用法
./cornpuzzle -x 14 -y 7 -b "  #|###||  #|###|| ##|###|| ##|###||## |###||  #|# #|###||  #|# #|###||# #|# #|###||  #|  #|###||#  |## |###|| # |###| ##|| ##|###|## ||  #|###|## ||#  |#  |## |###|| # | # | # |###|| ##| # | # |## ||  #|  #|###| ##"

# 启用详细输出
./cornpuzzle -x 14 -y 7 -b "..." -v

# 参数说明
# -x: 板子宽度 (默认: 14)
# -y: 板子高度 (默认: 7)
# -b: 拼图块定义，用'||'分隔每个块
# -v: 启用详细输出 (默认: false)
```

### 编程接口

```go
package main

import (
    "fmt"
    "github.com/gyyyy/cornpuzzle-go/cornpuzzle"
)

func main() {
    // 创建拼图 (14x7板子，17个块)
    blocks := []string{
        "  #|###", "  #|###", " ##|###", " ##|###",
        "## |###", "  #|# #|###", "  #|# #|###",
        "# #|# #|###", "  #|  #|###", "#  |## |###",
        " # |###| ##", " ##|###|## ", "  #|###|## ",
        "#  |#  |## |###", " # | # | # |###",
        " ##| # | # |## ", "  #|  #|###| ##",
    }

    puzzle, err := cornpuzzle.Create(14, 7, blocks)
    if err != nil {
        panic(err)
    }

    // 启用详细输出
    cornpuzzle.Verbose = true

    // 求解
    if cornpuzzle.Resolve(puzzle) {
        fmt.Printf("求解成功:\n%s\n", puzzle.Corn)
    } else {
        fmt.Println("求解失败")
    }
}
```

### 块定义格式

每个块使用字符串定义，格式如下：
- `|` 分隔行
- 空格表示空位
- `#` 表示占用位置

示例：
```
  #|###
```
表示一个2行2列的块，第一行右上角有块，第二行全满。

## 🏗️ 项目结构

```
cornpuzzle-go/
├── main.go              # 命令行工具入口
├── go.mod               # Go模块定义
├── LICENSE              # Apache 2.0许可证
├── README.md            # 项目文档
└── cornpuzzle/          # 核心包
    ├── puzzle.go        # 拼图数据结构和基础操作
    ├── resolve.go       # 求解算法实现
    └── puzzle_test.go   # 单元测试
```

### 核心组件

- **`Corn`**: 玉米拼图板子，支持环绕放置
- **`Block`**: 拼图块，包含形状、周长、复杂度等属性
- **`Puzzle`**: 完整拼图，包含板子和所有块
- **`Resolve()`**: 主要的求解函数，实现回溯算法

## 🧪 测试

运行测试套件：

```bash
# 运行所有测试
go test ./...

# 运行带性能测试
go test -v ./cornpuzzle/ -run TestResolve

# 运行基准测试 (如果有)
go test -bench=. ./...
```

## 📈 算法详解

### 回溯算法流程
1. **初始化**: 创建拼图，预计算块属性
2. **递归求解**: 尝试放置每个块到下一个空位
3. **验证放置**: 检查块是否能放入当前位置
4. **剪枝优化**: 如果当前路径无解，提前回退
5. **动态排序**: 根据当前空洞边界重新排序剩余块

### 启发式优化
- **复杂度排序**: 优先尝试形状简单的块
- **周长匹配**: 选择周长与当前空洞边界最接近的块
- **边界计算**: 实时计算空位的外边界长度

## 🤝 贡献

欢迎提交Issue和Pull Request！

### 开发环境设置
```bash
# 克隆仓库
git clone https://github.com/gyyyy/cornpuzzle-go.git
cd cornpuzzle-go

# 安装依赖
go mod download

# 运行测试确保一切正常
go test ./...
```

### 代码规范
- 遵循Go官方代码规范
- 添加必要的注释和文档
- 提交前运行所有测试

## 📄 许可证

本项目采用 [Apache License 2.0](LICENSE) 许可证。

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者！

---

**注意**: 这个项目是学习回溯算法和优化技术的实践项目，展示了如何通过智能启发式方法显著提升组合优化问题的求解效率。